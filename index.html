<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flutter Add-to-App: Integrating into Native Apps</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
            background-color: #f8fafc; 
        }
        .slide {
            min-height: 90vh; 
            padding: 4rem 2rem; 
            display: flex;
            flex-direction: column;
            justify-content: center; 
            align-items: center;
            text-align: center;
            border-bottom: 1px solid #e2e8f0; 
            position: relative; 
        }
        .slide:last-child {
            border-bottom: none;
        }
        .slide-title {
            font-size: 2.75rem; 
            font-weight: 800; 
            margin-bottom: 1rem; 
            color: #1e293b; 
        }
        .slide-subtitle {
            font-size: 1.375rem; 
            font-weight: 500;
            margin-bottom: 2rem; 
            color: #475569; 
            max-width: 750px; 
        }
        .content-grid {
            display: grid;
            grid-template-columns: 1fr; 
            gap: 2rem; 
            width: 100%;
            max-width: 1200px; 
        }
        @media (min-width: 768px) { 
            .content-grid {
                grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            }
        }

        .content-card {
            background-color: white;
            padding: 2rem 2.5rem; 
            border-radius: 0.75rem; 
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.07), 0 4px 6px -2px rgba(0,0,0,0.05);
            text-align: left;
            display: flex;
            flex-direction: column;
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
        }
        .content-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
        }
        .content-card h3 {
            font-size: 1.35rem; 
            font-weight: 700; 
            margin-bottom: 1rem; 
            color: #0f172a; 
            display: flex;
            align-items: center;
        }
        .content-card h3 svg, .content-card h3 i { 
            margin-right: 0.85rem; 
            width: 24px; 
            height: 24px;
        }
        .content-card p, .content-card ul {
            font-size: 1rem; 
            color: #334155; 
            line-height: 1.75; 
        }
        .content-card ul {
            list-style-type: disc; 
            list-style-position: outside; 
            padding-left: 1.5rem; 
            margin-top: 0.75rem;
        }
        .content-card li {
            margin-bottom: 0.6rem; 
        }
        .content-card a {
            color: #2563eb; 
            font-weight: 500;
            text-decoration: none;
            transition: color 0.2s ease, text-decoration 0.2s ease;
        }
        .content-card a:hover {
            color: #1d4ed8; 
            text-decoration: underline;
        }
        
        .code-snippet-wrapper {
            position: relative;
            margin-top: 0.75rem;
        }
        .code-snippet {
            background-color: #1e293b; 
            color: #e2e8f0; 
            padding: 1rem 1.25rem; 
            padding-top: 2.5rem; 
            border-radius: 0.375rem; 
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            font-size: 0.875rem; 
            overflow-x: auto;
            text-align: left;
            border: 1px solid #334155; 
        }
        .code-snippet code {
            white-space: pre;
        }
        .copy-code-button {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #334155; 
            color: #cbd5e1; 
            border: none;
            padding: 0.3rem 0.6rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .copy-code-button:hover {
            background-color: #475569; 
            color: #f1f5f9; 
        }
        .copy-code-button .fa-copy {
            margin-right: 0.3rem;
        }
        .copy-code-button.copied {
            background-color: #16a34a; 
            color: white;
        }

        .nav-bar {
            position: sticky;
            top: 0;
            background-color: #0f172a; 
            backdrop-filter: blur(16px); 
            padding: 0.5rem 1.5rem; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
            z-index: 50;
            display: flex;
            align-items: center; 
            justify-content: space-between; 
        }
        .nav-brand-logos {
            display: flex;
            align-items: center;
            gap: 0.5rem; 
        }
        .nav-brand-logos img {
            height: 24px; 
            width: auto;
        }
        .nav-links-container {
            display: flex;
            flex-wrap: wrap; 
            gap: 0.25rem 0.5rem; 
        }
        .nav-link {
            color: #cbd5e1; 
            font-weight: 500; 
            padding: 0.6rem 0.8rem; 
            border-radius: 0.375rem; 
            transition: color 0.2s ease-in-out, border-color 0.2s ease-in-out;
            font-size: 0.9rem; 
            border-bottom: 2px solid transparent; 
        }
        .nav-link:hover {
            color: #f8fafc; 
            border-bottom-color: #3b82f6; 
        }

        .button-primary {
            background-image: linear-gradient(to right, #3b82f6, #60a5fa); 
            color: white;
            padding: 0.85rem 2rem; 
            border-radius: 0.5rem;
            font-weight: 600; 
            transition: all 0.3s ease;
            display: inline-block;
            margin-top: 2rem; 
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            border: none;
        }
        .button-primary:hover {
            background-image: linear-gradient(to right, #2563eb, #3b82f6);
            transform: translateY(-3px) scale(1.02); 
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
        }

        #what { 
            height: 212px; 
            min-height: unset; 
            padding-top: 1rem; 
            padding-bottom: 1rem; 
            justify-content: center; 
            background-color: #075985; 
            background-image: 
                radial-gradient(at 15% 25%, hsla(215, 98%, 61%, 0.7) 0px, transparent 40%), 
                radial-gradient(at 85% 15%, hsla(195, 98%, 72%, 0.6) 0px, transparent 40%),
                radial-gradient(at 50% 85%, hsla(196, 98%, 62%, 0.5) 0px, transparent 50%),
                radial-gradient(at 5% 15%, hsla(210, 98%, 61%, 0.6) 0px, transparent 40%),
                radial-gradient(at 90% 90%, hsla(201, 98%, 60%, 0.7) 0px, transparent 50%);
            color: white;
            overflow: hidden; 
            align-items: center; 
        }
        .slide1-content-wrapper { 
            display: flex;
            width: 100%;
            max-width: 1100px; 
            align-items: center; 
            justify-content: space-between; 
            flex-grow: 0; 
        }
        .hero-text-content {
            text-align: left; 
            z-index: 10; 
            position: relative;
            flex-grow: 1; 
            padding-right: 1rem; 
        }
        .hero-corner-graphic { 
            transform: scale(0.5); 
            transform-origin: center center; 
            z-index: 5; 
            flex-shrink: 0; 
        }
        .hero-text-content .slide-title { 
            color: white; 
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
            font-size: 2.5rem; 
            line-height: 1.1;
            margin-bottom: 0.5rem; 
        }
        .hero-text-content .slide-subtitle-main { 
            color: #e0f2fe; 
            text-shadow: 1px 1px 2px rgba(0,0,0,0.15);
            font-size: 1.1rem; 
            line-height: 1.4; 
            margin-bottom: 0.5rem;
        }
        .hero-text-content .slide-subtitle-secondary { 
            font-size: 0.95rem; 
            font-weight: 500; 
            color: #bae6fd; 
        }
        
        #android-flutter-showcase { }
        .dash-mascot-img { 
            object-fit: contain;
            width: 190px; 
            height: auto;
        }
        .bugdroid-helmet-img { 
            width: 60px;  
            height: auto;
        }
        .flutter-on-helmet-logo { 
            width: 10px; 
            height: auto;
            filter: none; 
        }
        @media (min-width: 640px) { 
            .dash-mascot-img { width: 255px; }
            .bugdroid-helmet-img { width: 78px; }
            .flutter-on-helmet-logo { width: 14px; }
        }
        .android-head-svg {
            max-width: 100%;
            height: auto;
        }
        #android-flutter-showcase details > summary { 
            list-style: none;
            cursor: pointer;
        }
        #android-flutter-showcase details > summary::-webkit-details-marker { 
            display: none;
        }
        #android-flutter-showcase details summary::after { 
            content: ' ▼';
            font-size: 0.7em;
            margin-left: 0.3rem;
        }
        #android-flutter-showcase details[open] summary::after { 
            content: ' ▲';
        }
        .dash-with-helmet-container {
            position: relative; 
            display: flex; 
            justify-content: center;
            align-items: center; 
            margin-bottom: 1rem; 
            height: 270px; 
        }
        .dash-base-container { z-index: 10; }
        .bugdroid-helmet-unit {
            position: absolute;
            top: 18%;  
            left: 52%; 
            transform: translateX(-50%);
            z-index: 20; 
            display: flex; 
            justify-content: center;
            align-items: center;
        }
        .flutter-logo-on-helmet-container { 
            position: absolute;
            top: 45%; 
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 25; 
        }

        .architecture-diagram-container {
            width: 100%;
            max-width: 900px;
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 20px rgba(0,0,0,0.08);
            margin: 2rem auto;
        }
        .architecture-diagram-container svg text {
            font-family: 'Inter', sans-serif;
            fill: #334155;
        }
        .architecture-diagram-container svg .label { font-size: 13px; font-weight: 600; }
        .architecture-diagram-container svg .sub-label { font-size: 11px; fill: #64748b; }
        .architecture-diagram-container svg .arrow-line { stroke: #60a5fa; stroke-width: 2; }
        .architecture-diagram-container svg .arrow-head { fill: #60a5fa; }
        .architecture-diagram-container svg .box { stroke: #94a3b8; stroke-width: 1.5; rx: 6; }
        
        .demo-visual-placeholder {
            width: 100%;
            height: 200px;
            background-color: #e2e8f0;
            border: 2px dashed #cbd5e1;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 0.5rem;
            margin-top: 1rem;
            color: #64748b;
        }
        .demo-link-icons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 0.5rem;
        }
        .demo-link-icons a {
            color: #2563eb;
            font-size: 1.5rem; 
        }
        .demo-link-icons a:hover {
            color: #1d4ed8;
        }


        @media (max-width: 768px) {
            #what { 
                height: auto; 
                min-height: 40vh; 
                padding-top: 1.5rem;
                padding-bottom: 1.5rem;
            }
            .slide1-content-wrapper {
                flex-direction: column-reverse; 
                align-items: center;
                text-align: center; 
            }
            .hero-corner-graphic {
                position: static; 
                transform: scale(0.5); 
                margin-top: 1rem; 
                margin-left: 0; 
            }
            .hero-text-content {
                text-align: center; 
                padding-left: 0; 
                padding-right: 0;
            }
            .hero-text-content .slide-title { font-size: 2.25rem; } 
            .hero-text-content .slide-subtitle-main { font-size: 1rem; } 
            .hero-text-content .slide-subtitle-secondary { font-size: 0.9rem; } 
            
            .slide { padding: 2rem 1rem; min-height: auto; } 
            .slide-title { font-size: 2rem; } 
            .slide-subtitle { font-size: 1.125rem; }
            .content-grid { grid-template-columns: 1fr; }
            .nav-bar { 
                flex-direction: column; 
                align-items: center; 
                padding: 0.75rem 1rem;
            }
            .nav-brand-logos { margin-bottom: 0.5rem; }
            .nav-links-container { justify-content: center; width: 100%; }
            .nav-link { padding: 0.5rem 0.6rem; font-size: 0.85rem; }
            .architecture-diagram-container { padding: 1rem; }
            .architecture-diagram-container svg .label { font-size: 11px; }
            .architecture-diagram-container svg .sub-label { font-size: 9px; }
        }
        @media (max-width: 480px) {
            .nav-links-container { gap: 0.1rem 0.2rem; }
            .nav-link { padding: 0.5rem 0.4rem; font-size: 0.8rem; }
            .hero-corner-graphic { transform: scale(0.45); }
            .hero-text-content .slide-title { font-size: 2rem; }
            .hero-text-content .slide-subtitle-main { font-size: 0.95rem; }
        }
    </style>
</head>
<body class="text-slate-800">

    <nav class="nav-bar">
        <div class="nav-brand-logos">
            <img src="https://developer.android.com/static/images/brand/android-head_3D.svg" alt="Android Logo" title="Android">
            <img src="https://storage.googleapis.com/cms-storage-bucket/4fd5520fe28ebf839174.svg" alt="Flutter Logo" title="Flutter">
        </div>
        <div class="nav-links-container">
            <a href="#what" class="nav-link">What</a> 
            <a href="#slide2" class="nav-link">Why</a>
            <a href="#slide3" class="nav-link">How</a>
            <a href="#slide4" class="nav-link">Arch</a>
            <a href="#new-io" class="nav-link">New @ I/O</a> 
            <a href="#web-integration" class="nav-link">Web</a>
            <a href="#web-workers-serviceworkers" class="nav-link">Web Workers</a> 
            <a href="#slide5" class="nav-link">POC</a> 
            <a href="#slide6" class="nav-link">Next</a>
        </div>
    </nav>

    <section id="what" class="slide"> 
        <div class="slide1-content-wrapper">
            <div class="hero-text-content">
                <h1 class="slide-title">What is Flutter Add-to-App?</h1>
                <p class="slide-subtitle-main">Incrementally integrating Flutter screens or features into existing native mobile (and potentially web/desktop) applications.</p>
                <p class="slide-subtitle-secondary">A Technical Guide for Integrating with Existing Codebases.</p>
            </div>
            <div class="hero-corner-graphic">
                <div id="android-flutter-showcase" class="bg-white p-6 sm:p-8 rounded-xl shadow-2xl flex flex-col items-center justify-center"> 
                    <div class="dash-with-helmet-container">
                        <div class="dash-base-container transition-transform duration-300 ease-in-out hover:scale-105" title="Dash">
                            <img src="https://storage.googleapis.com/cms-storage-bucket/780e0e64d323aad2cdd5.png" alt="Flutter Dash Mascot from flutter.dev/brand" class="dash-mascot-img rounded-md">
                        </div>
                        <div class="bugdroid-helmet-unit transition-transform duration-300 ease-in-out hover:rotate-[-5deg] hover:scale-110" title="Bugdroid Helmet">
                            <img src="https://developer.android.com/static/images/brand/android-head_3D.svg" alt="Android Robot Head as Helmet" class="bugdroid-helmet-img android-head-svg">
                            <div class="flutter-logo-on-helmet-container">
                                <img src="https://storage.googleapis.com/cms-storage-bucket/4fd5520fe28ebf839174.svg" alt="Flutter Logo on Helmet" class="flutter-on-helmet-logo">
                            </div>
                        </div>
                    </div>
                    <details class="w-full max-w-xs sm:max-w-sm">
                        <summary class="text-xs text-gray-500 hover:text-gray-700 focus:outline-none text-center py-2">
                            Logo usage info
                        </summary>
                        <p class="disclaimer text-[9px] sm:text-[11px] text-gray-400 text-center max-w-md leading-relaxed mt-2 px-2">
                            The Android robot (developer.android.com/distribute/marketing-tools/brand-guidelines) is reproduced or modified from work created and shared by Google and used according to terms described in the Creative Commons 3.0 Attribution License. The Flutter logo and Dash character (flutter.dev/brand) are trademarks of Google LLC. This visual is for illustrative fun and does not imply endorsement by Google.
                        </p>
                    </details>
                </div>
            </div>
        </div>
    </section>

    <section id="slide2" class="slide bg-white">
        <h2 class="slide-title">The Strategic "Why"</h2>
        <p class="slide-subtitle">Add-to-app offers specific advantages for evolving existing native codebases with Flutter's power.</p>
        <div class="content-grid why-section-grid"> 
            <div class="content-card">
                <h3><i class="fas fa-layer-group text-blue-500"></i>Leverage Existing Investment</h3>
                <p>Preserve stable native features and business logic. Introduce Flutter for new UIs or self-contained feature modules without a full rewrite. Read more on <a href="https://flutter.dev/docs/development/add-to-app" target="_blank" rel="noopener noreferrer">official Add-to-App docs</a>.</p>
            </div>
            <div class="content-card">
                <h3><i class="fas fa-rocket text-green-500"></i>Targeted Modernization</h3>
                <p>Incrementally replace specific native screens or flows with Flutter, focusing on areas needing UI/UX uplift or faster iteration cycles.</p>
            </div>
            <div class="content-card">
                <h3><i class="fas fa-users-cog text-purple-500"></i>Unified Dev Experience</h3>
                <p>Utilize Flutter's productive developer experience (hot reload, rich widget set) for new modules, boosting team velocity for those parts.</p>
            </div>
             <div class="content-card">
                <h3><i class="fas fa-chart-line text-yellow-500"></i>Skillset Expansion & Future-Proofing</h3>
                <p>Allows native teams to gradually adopt Flutter, expanding their skillset and aligning with modern cross-platform development trends.</p>
            </div>
        </div>
    </section>

    <section id="slide3" class="slide bg-slate-50">
        <h2 class="slide-title">The Core "How": Technical Pillars</h2>
        <p class="slide-subtitle">Understanding the key mechanisms for integrating Flutter modules effectively.</p>
        <div class="content-grid how-section-grid"> 
            <div class="content-card">
                <h3><i class="fas fa-puzzle-piece text-sky-500"></i>Flutter Module & Artifacts</h3>
                <p>A Flutter project of type `module` (`flutter create -t module my_flutter`) produces specific build artifacts for native integration:</p>
                <ul>
                    <li><strong>iOS:</strong> `.xcframework` (e.g., `Flutter.xcframework`, `App.xcframework`). <a href="https://flutter.dev/docs/development/add-to-app/ios/project-setup" target="_blank" rel="noopener noreferrer">iOS Setup Guide</a>.</li>
                    <li><strong>Android:</strong> `.aar` (Android Archive). <a href="https://flutter.dev/docs/development/add-to-app/android/project-setup" target="_blank" rel="noopener noreferrer">Android Setup Guide</a>.</li>
                </ul>
            </div>
            <div class="content-card">
                <h3><i class="fas fa-cogs text-teal-500"></i>FlutterEngine: The Heartbeat</h3>
                <p>The `FlutterEngine` hosts your Dart VM, isolates, and runs Flutter code. Its management is crucial for performance. Engines can be pre-warmed (e.g., in Android's <code class="text-xs bg-slate-200 p-1 rounded">MainActivity.kt</code> or iOS's <code class="text-xs bg-slate-200 p-1 rounded">AppDelegate.swift</code>) for optimal performance. Example for Android:</p>
                <div class="code-snippet-wrapper">
                    <button class="copy-code-button" aria-label="Copy code snippet"><i class="fas fa-copy"></i> Copy</button>
                    <pre class="code-snippet"><code class="language-kotlin">// In your Application class (MyApplication.kt)
override fun onCreate() {
    super.onCreate()
    flutterEngine = FlutterEngine(this)
    flutterEngine.dartExecutor.executeDartEntrypoint(
        DartExecutor.DartEntrypoint.createDefault()
    )
    FlutterEngineCache.getInstance().put("my_engine_id", flutterEngine)
}

// In MainActivity.kt using the cached engine
// Make sure your Activity extends FlutterActivity or uses FlutterFragment
// For FlutterActivity:
override fun provideFlutterEngine(context: Context): FlutterEngine? {
    return FlutterEngineCache.getInstance().get("my_engine_id")
}</code></pre>
                </div>
                <ul>
                    <li>Pre-warming via <a href="https://api.flutter.dev/flutter/flutter_embedding/FlutterEngineCache-class.html" target="_blank" rel="noopener noreferrer">`FlutterEngineCache`</a> is vital for fast "warm starts".</li>
                    <li><a href="https://api.flutter.dev/flutter/flutter_embedding/FlutterEngineGroup-class.html" target="_blank" rel="noopener noreferrer">`FlutterEngineGroup`</a> for multiple Flutter instances. See <a href="https://github.com/flutter/samples/tree/master_archived/add_to_app/multiple_flutters" target="_blank" rel="noopener noreferrer">Multiple Flutters sample</a>.</li>
                </ul>
            </div>
            <div class="content-card">
                <h3><i class="fas fa-exchange-alt text-indigo-500"></i>Platform Channels: The Bridge</h3>
                <p>Enable bi-directional communication. <a href="https://flutter.dev/docs/development/platform-integration/platform-channels" target="_blank" rel="noopener noreferrer">Learn about Platform Channels</a>.</p>
                <ul>
                    <li><strong><a href="https://pub.dev/packages/pigeon" target="_blank" rel="noopener noreferrer">Pigeon</a>:</strong> <strong><em>Recommended.</em></strong> A code-gen tool for type-safe platform channels, reducing boilerplate. See the <a href="https://github.com/flutter/samples/tree/master_archived/add_to_app/books" target="_blank" rel="noopener noreferrer">Books (Pigeon) sample</a>.</li>
                    <li><strong>`MethodChannel`</strong>: Async method calls.</li>
                    <li><strong>`EventChannel`</strong>: Native-to-Dart streams.</li>
                    <li><strong>`BasicMessageChannel`</strong>: Simpler messaging.</li>
                    <li>For highly performant or direct native API access, explore <strong>Dart FFI (ffigen)</strong> and <strong>JNI (JNIGen)</strong> (see Advanced Exploration).</li>
                </ul>
            </div>
            <div class="content-card">
                <h3><i class="fas fa-mobile-alt text-rose-500"></i>Native Embedding APIs</h3>
                <p>Platform-specific classes to host Flutter UI.</p>
                <ul>
                    <li><strong>iOS:</strong> <a href="https://api.flutter.dev/flutter/flutter_embedding/FlutterViewController-class.html" target="_blank" rel="noopener noreferrer">`FlutterViewController`</a>.</li>
                    <li><strong>Android:</strong>
                        <ul class="list-disc list-inside ml-4">
                            <li><a href="https://api.flutter.dev/flutter/flutter_embedding/FlutterActivity-class.html" target="_blank" rel="noopener noreferrer">`FlutterActivity`</a> (full-screen).</li>
                            <li><a href="https://api.flutter.dev/flutter/flutter_embedding/FlutterFragment-class.html" target="_blank" rel="noopener noreferrer">`FlutterFragment`</a> (partial screen). See <a href="https://github.com/flutter/samples/tree/master_archived/add_to_app/android_view" target="_blank" rel="noopener noreferrer">Android View sample</a>.</li>
                        </ul>
                    </li>
                </ul>
            </div>
            <div class="content-card lg:col-span-1 md:col-span-2"> <h3><i class="fas fa-route text-orange-500"></i>Navigation & Initial Data</h3>
                <p>Pass initial data to Flutter efficiently. For example, on Android, use <code class="text-xs bg-slate-200 p-1 rounded">Intent.putExtra()</code> when launching a `FlutterActivity`. This is often simpler than an immediate `MethodChannel` call for startup parameters (e.g., a movie ID). <a href="https://stackoverflow.com/a/78114892" target="_blank" rel="noopener noreferrer">See example</a>.</p>
                 <div class="code-snippet-wrapper">
                    <button class="copy-code-button" aria-label="Copy code snippet"><i class="fas fa-copy"></i> Copy</button>
                    <pre class="code-snippet"><code class="language-kotlin">// Native Android (Kotlin) - Starting FlutterActivity
val intent = FlutterActivity
    .withNewEngine()
    .initialRoute("/movieDetails?id=myMovieId123") // Option 1: Use initialRoute
    .build(context)
// intent.putExtra("movie_id", "myMovieId123") // Option 2: Use Intent extras (requires channel to read)
startActivity(intent)

// Flutter (Dart) - main.dart or router
// void main() {
//   final String initialRoute = WidgetsBinding.instance.window.defaultRouteName;
//   runApp(MyApp(initialRoute: initialRoute));
// }
// Then parse 'initialRoute' in your app's routing logic.
</code></pre>
                </div>
                <ul>
                    <li><strong>iOS:</strong> Use `initialRoute` on `FlutterViewController` or set custom properties.</li>
                </ul>
            </div>
        </div>
    </section>

    <section id="slide4" class="slide bg-white">
        <h2 class="slide-title">Architectural Overview</h2>
        <p class="slide-subtitle">Visualizing the interaction between the native host and the Flutter module.</p>
        <div class="architecture-diagram-container">
            <svg viewBox="0 0 600 450" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" class="arrow-head" />
                    </marker>
                </defs>
                <rect x="50" y="30" width="500" height="150" fill="#e0f2fe" class="box"/>
                <text x="300" y="55" text-anchor="middle" class="label">Native Host Application (iOS/Android)</text>
                <rect x="70" y="80" width="220" height="70" fill="#ffffff" class="box"/>
                <text x="180" y="105" text-anchor="middle" class="label">Native UI</text>
                <text x="180" y="125" text-anchor="middle" class="sub-label">(Activities/ViewControllers)</text>
                <rect x="310" y="80" width="220" height="70" fill="#ffffff" class="box"/>
                <text x="420" y="105" text-anchor="middle" class="label">Native Business Logic</text>
                <text x="420" y="125" text-anchor="middle" class="sub-label">(SDKs, Services)</text>
                <rect x="50" y="270" width="500" height="150" fill="#cffafe" class="box"/>
                <text x="300" y="295" text-anchor="middle" class="label">Flutter Module (Dart)</text>
                <rect x="70" y="320" width="220" height="70" fill="#ffffff" class="box"/>
                <text x="180" y="345" text-anchor="middle" class="label">Flutter UI</text>
                <text x="180" y="365" text-anchor="middle" class="sub-label">(Widgets, State)</text>
                <rect x="310" y="320" width="220" height="70" fill="#ffffff" class="box"/>
                <text x="420" y="345" text-anchor="middle" class="label">Flutter Business Logic</text>
                <text x="420" y="365" text-anchor="middle" class="sub-label">(Services, Repositories)</text>
                <rect x="150" y="190" width="300" height="70" fill="#fee2e2" class="box"/>
                <text x="300" y="210" text-anchor="middle" class="label">Integration Layer</text>
                <text x="300" y="230" text-anchor="middle" class="sub-label">FlutterEngine, Embedding APIs</text>
                <text x="300" y="245" text-anchor="middle" class="sub-label">Platform Channels / Pigeon</text>
                <line x1="300" y1="180" x2="300" y2="190" class="arrow-line" marker-end="url(#arrowhead)"/>
                <line x1="300" y1="260" x2="300" y2="270" class="arrow-line" marker-end="url(#arrowhead)"/>
                <path d="M200 260 Q220 225 250 190" stroke-dasharray="4 2" class="arrow-line" marker-end="url(#arrowhead)" fill="none"/>
                <path d="M400 260 Q380 225 350 190" stroke-dasharray="4 2" class="arrow-line" marker-end="url(#arrowhead)" fill="none"/>
            </svg>
        </div>
         <div class="max-w-3xl mx-auto text-left mt-6 space-y-3 text-slate-700 text-base">
            <p>The native app hosts the <a href="https://api.flutter.dev/flutter/flutter_embedding/FlutterEngine-class.html" target="_blank" rel="noopener noreferrer">FlutterEngine</a>, which runs Dart code. Native embedding APIs (like `FlutterViewController` or `FlutterActivity`) display Flutter's UI. Communication flows via <a href="https://flutter.dev/docs/development/platform-integration/platform-channels" target="_blank" rel="noopener noreferrer">Platform Channels</a> or <a href="https://pub.dev/packages/pigeon" target="_blank" rel="noopener noreferrer">Pigeon</a>.</p>
        </div>
    </section>

    <section id="new-io" class="slide bg-indigo-50">
        <h2 class="slide-title">New @ I/O: Key Themes</h2>
        <p class="slide-subtitle">Recent announcements and directions relevant to Flutter & Add-to-App.</p>
        <div class="content-grid md:grid-cols-2">
            <div class="content-card">
                <h3><i class="fas fa-microchip text-purple-600"></i>Enhanced AI Integration</h3>
                <p>On-device AI (e.g., via Gemini Nano in ML Kit or new native APIs) can enhance the capabilities of the *native host app*. Flutter modules can then interact with these AI-powered native features via platform channels.</p>
                <ul>
                    <li>Future Flutter plugins might also provide direct Dart access to such on-device models.</li>
                    <li>AI in dev tools (e.g., Firebase Studio, "Stitch") can accelerate prototyping for UI modules intended for Add-to-App.</li>
                </ul>
            </div>
            <div class="content-card">
                <h3><i class="fas fa-link text-green-600"></i>Deeper Native Interoperability</h3>
                <p>Focus on more seamless and performant ways to interact with native platform code, crucial for Add-to-App. This includes advancements and tooling around:</p>
                <ul>
                    <li><strong>Dart FFI (Foreign Function Interface):</strong> For calling C-compatible libraries directly. <a href="https://dart.dev/interop/c-interop" target="_blank" rel="noopener noreferrer">Learn more about FFI</a>. The <code class="text-xs bg-slate-200 p-1 rounded">ffigen</code> tool helps generate Dart bindings.</li>
                    <li><strong>JNI (Java Native Interface) on Android:</strong> For Dart to call Kotlin/Java code. The <a href="https://github.com/dart-lang/jnigen" target="_blank" rel="noopener noreferrer"><code class="text-xs bg-slate-200 p-1 rounded">jnigen</code></a> tool facilitates this by generating Dart and JNI/C bindings.</li>
                    <li>These mechanisms are key for performance-critical sections or when complex native APIs need direct access, potentially bypassing some platform channel overhead.</li>
                </ul>
            </div>
            <div class="content-card">
                <h3><i class="fab fa-chrome text-orange-500"></i>Web Platform Advancements</h3>
                <p>Continued improvements for Flutter on the Web, making it a more viable target for Add-to-App scenarios within existing web applications.</p>
                <ul>
                    <li><strong>Performance:</strong> Maturation of WebAssembly (WasmGC) for faster load times and execution.</li>
                    <li><strong>Tooling & DX:</strong> Features like hot reload for web becoming more stable and widespread.</li>
                </ul>
            </div>
            <div class="content-card">
                <h3><i class="fas fa-palette text-red-500"></i>Impeller Rendering Engine</h3>
                <p>Impeller, as the default renderer on more platforms, ensures consistent high performance and fidelity, which is beneficial for any UI, including those in Add-to-App modules.</p>
                <ul>
                    <li>Provides smoother animations and predictable performance, critical for a good user experience when mixing native and Flutter UIs.</li>
                </ul>
            </div>
        </div>
    </section>

    <section id="web-integration" class="slide bg-teal-50">
        <h2 class="slide-title">Web Integration Considerations</h2>
        <p class="slide-subtitle">Adding Flutter to existing web applications introduces unique aspects.</p>
        <div class="content-grid md:grid-cols-2 lg:grid-cols-3"> 
            <div class="content-card">
                <h3><i class="fas fa-code text-teal-600"></i>Embedding Methods</h3>
                <ul>
                    <li><strong>`&lt;iframe&gt;`</strong>: Simple isolation, but communication can be limited.</li>
                    <li><strong>JavaScript Embedding API (`flutter.js`):</strong> Tighter integration by loading Flutter into a specific `&lt;div&gt;`. See <a href="https://docs.flutter.dev/platform-integration/web/embedding" target="_blank" rel="noopener noreferrer">Embedding Docs</a>.</li>
                </ul>
            </div>
            <div class="content-card">
                <h3><i class="fas fa-comments text-cyan-600"></i>Communication: JS Interop</h3>
                <p>Use <code class="text-xs bg-slate-200 p-1 rounded">dart:js_interop</code> (modern) or older `dart:js` / `package:js` to call JavaScript functions from Dart and vice-versa.</p>
            </div>
            <div class="content-card">
                <h3><i class="fas fa-sitemap text-blue-600"></i>Routing & Navigation</h3>
                <p>Coordinate Flutter's internal routing with the host web app's routing, especially with JS embedding. Manage URL changes and history carefully.</p>
            </div>
            <div class="content-card">
                <h3><i class="fas fa-server text-indigo-600"></i>Build & Hosting</h3>
                <p>`flutter build web` generates static files. Host these alongside your existing web app, ensuring correct asset paths.</p>
            </div>
            <div class="content-card"> 
                <h3><i class="fas fa-cogs text-lime-600"></i>Performance & Wasm</h3>
                <ul>
                    <li><strong>WebAssembly (Wasm):</strong> Flutter web can compile to Wasm (with WasmGC) for potentially faster execution and load times. <a href="https://webassembly.org" target="_blank" rel="noopener noreferrer">Learn about Wasm</a> / <a href="https://docs.flutter.dev/platform-integration/web/wasm" target="_blank" rel="noopener noreferrer">Flutter Wasm</a>.</li>
                    <li>Initial load time is a factor. Choose between CanvasKit (performance) or HTML (compatibility/size) renderers.</li>
                </ul>
            </div>
             <div class="content-card md:col-span-1 lg:col-span-1"> 
                <h3><i class="fas fa-photo-video text-purple-600"></i>Demo Visuals (Web)</h3>
                <p>Illustrating web integration:</p>
                <div class="demo-visual-placeholder mt-2">
                    <p>[Animated GIF: Web App + Flutter Module Interaction]</p>
                </div>
                <div class="demo-link-icons">
                    <a href="#" title="Expand/Play Video"><i class="fas fa-play-circle"></i></a>
                    <a href="#" title="View Live Web Demo"><i class="fas fa-external-link-alt"></i></a>
                </div>
            </div>
        </div>
    </section>
    
    <section id="web-workers-serviceworkers" class="slide bg-sky-50">
        <h2 class="slide-title">Web: Workers & PWA Strategy</h2>
        <p class="slide-subtitle">Understanding background processing and Progressive Web App considerations for Flutter web modules.</p>
        <div class="content-grid md:grid-cols-2">
            <div class="content-card">
                <h3><i class="fas fa-industry text-sky-700"></i>Web Workers</h3>
                <p>For offloading CPU-intensive tasks from the main UI thread to prevent UI jank in your Flutter web module or the host application.</p>
                <ul>
                    <li><strong>Purpose:</strong> True background processing in a separate thread.</li>
                    <li><strong>Mechanism:</strong> Communicate with the main thread via `postMessage()`. No direct DOM access.</li>
                    <li><strong>Use Cases:</strong> Complex calculations, data processing, image manipulation.</li>
                    <li><strong>Flutter Context:</strong> Typically used via JS Interop (<code class="text-xs bg-slate-200 p-1 rounded">dart:js_interop</code>) or through packages abstracting worker communication. <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API" target="_blank" rel="noopener noreferrer">MDN: Web Workers</a>.</li>
                </ul>
            </div>
            <div class="content-card">
                <h3><i class="fas fa-shield-alt text-cyan-700"></i>Service Workers & PWA Strategy</h3>
                <p>Primarily for enabling Progressive Web App (PWA) features like offline support, caching, and push notifications.</p>
                <ul>
                    <li><strong>Flutter's Default Service Worker:</strong> The `flutter_service_worker.js` generated by <code class="text-xs bg-slate-200 p-1 rounded">flutter build web</code> for PWA caching **is deprecated**. It is being phased out due to inflexibility and to give developers more control.</li>
                    <li><strong>Disabling Default:</strong> Use <code class="text-xs bg-slate-200 p-1 rounded">flutter build web --pwa-strategy=none</code> to prevent its generation. This relies on standard browser HTTP caching.
                        <ul>
                            <li><em>When to disable:</em> If PWA features (especially offline caching) are not a primary goal for your embedded Flutter web module, or if you prefer simpler browser caching and control.</li>
                            <li><em>Disadvantage of disabling:</em> No out-of-the-box PWA caching/offline capabilities without further custom implementation.</li>
                        </ul>
                    </li>
                    <li><strong>Custom Service Worker:</strong> If PWA features are desired, you **must implement your own** service worker.
                        <ul>
                            <li>Tools like <a href="https://developer.chrome.com/docs/workbox/" target="_blank" rel="noopener noreferrer">Workbox</a> (a set of JavaScript libraries) can greatly simplify building robust service workers.</li>
                            <li>For manual implementation, refer to <a href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API" target="_blank" rel="noopener noreferrer">MDN: Service Workers</a> and <a href="https://web.dev/learn/pwa/service-workers/" target="_blank" rel="noopener noreferrer">web.dev Service Worker guides</a>.</li>
                        </ul>
                    </li>
                    <li>See also: <a href="https://docs.flutter.dev/platform-integration/web/faq#how-do-i-configure-a-service-worker" target="_blank" rel="noopener noreferrer">Flutter Web FAQ on Service Workers</a>.</li>
                </ul>
            </div>
        </div>
    </section>

    <section id="slide5" class="slide bg-slate-50">
        <h2 class="slide-title">Illustrative POC Strategy & Samples</h2> 
        <p class="slide-subtitle">A phased approach to demonstrate capability and explore value, supported by official Flutter samples.</p>
        <div class="content-grid">
            <div class="content-card">
                <h3><i class="fas fa-flask text-cyan-500"></i>POC: Foundational Integration</h3>
                <p>Objective: Confirm successful setup, build, and basic interop.</p>
                <ul>
                    <li>Integrate a simple Flutter module into minimal native iOS & Android hosts.</li>
                    <li>Demonstrate launching a Flutter screen from native.</li>
                    <li>Implement basic back-navigation.</li>
                    <li>Focus on `FlutterEngine` initialization (ideally pre-warmed for performance).</li>
                </ul>
            </div>
            <div class="content-card">
                <h3><i class="fas fa-lightbulb text-amber-500"></i>POC: Value-Driven Scenario</h3> 
                <p>Objective: Showcase a practical use case with more complex interactions.</p>
                <p class="font-semibold mt-2">Example: "Native List -> Flutter Detail Screen"</p>
                <ul>
                    <li>Native screen displays a list. Tapping an item launches Flutter, passing data.</li>
                    <li>Flutter screen displays rich details, potentially fetching more data.</li>
                    <li>Action in Flutter (e.g., "Favorite") communicates back to update native state/UI.</li>
                </ul>
            </div>
        </div>
        <a href="https://github.com/flutter/samples/tree/master_archived/add_to_app" target="_blank" rel="noopener noreferrer" class="button-primary">
            <i class="fab fa-github mr-2"></i> Explore Add-to-App Samples
        </a>
        <div class="max-w-2xl mx-auto text-left mt-6 space-y-2 text-slate-600 text-sm">
            <p class="font-semibold">Key samples to explore:</p>
            <ul class="list-disc list-inside">
                <li><a href="https://github.com/flutter/samples/tree/master_archived/add_to_app/multiple_flutters" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:text-blue-800">Multiple Flutters:</a> Demonstrates managing multiple FlutterEngine instances.</li>
                <li><a href="https://github.com/flutter/samples/tree/master_archived/add_to_app/books" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:text-blue-800">Books App:</a> A more complete example using Pigeon for type-safe platform channels.</li>
                <li><a href="https://github.com/flutter/samples/tree/master_archived/add_to_app/android_view" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:text-blue-800">Android View (Platform View):</a> Shows embedding native Android views within Flutter UI.</li>
            </ul>
        </div>
    </section>

    <section id="slide6" class="slide bg-white">
        <h2 class="slide-title">Path Forward & Advanced Considerations</h2>
        <div class="max-w-4xl mx-auto space-y-8">
            <div class="content-card">
                <h3><i class="fas fa-tasks text-green-500"></i>Core Implementation Steps</h3>
                <ol class="list-decimal list-inside space-y-1">
                    <li>Define clear integration points for initial Flutter modules.</li>
                    <li>Establish Flutter module structure and native project configurations.</li>
                    <li>Implement `FlutterEngine` management (e.g., caching via `FlutterEngineCache`).</li>
                    <li>Develop Platform Channel / <a href="https://pub.dev/packages/pigeon" target="_blank" rel="noopener noreferrer">Pigeon</a> contracts for communication.</li>
                    <li>Thoroughly test navigation, data passing, and lifecycle management.</li>
                </ol>
            </div>
            <div class="grid md:grid-cols-2 gap-6">
                <div class="content-card">
                    <h3><i class="fas fa-tools text-orange-500"></i>Key Technical Considerations</h3>
                    <ul>
                        <li><strong>Engine Lifecycle:</strong> Align `FlutterEngine` with native component lifecycles.</li>
                        <li><strong>State Synchronization:</strong> Strategies for consistency if states are shared.</li>
                        <li><strong>Plugin Conflicts:</strong> Manage potential native SDK conflicts.</li>
                        <li><strong>Build & CI/CD:</strong> Integrate Flutter module builds into the main native app pipeline. See <a href="https://docs.flutter.dev/deployment/cd" target="_blank" rel="noopener noreferrer">CI/CD for Flutter</a>.</li>
                    </ul>
                </div>
                <div class="content-card">
                    <h3><i class="fas fa-brain text-violet-500"></i>Advanced Exploration</h3>
                    <p>For deeper integration or leveraging complex native logic. These are becoming increasingly important for complex integrations and maximizing performance by bypassing some channel overhead:</p>
                    <ul>
                        <li><strong><a href="https://flutter.dev/docs/development/platform-integration/c-interop" target="_blank" rel="noopener noreferrer">Dart FFI (ffigen)</a>:</strong> Call C/C++ libraries directly from Dart.</li>
                        <li><strong>JNI Interop (Android) with <a href="https://github.com/dart-lang/jnigen" target="_blank" rel="noopener noreferrer">JNIGen</a>:</strong> For complex Java/Kotlin interaction, often via FFI bridges.</li>
                        <li><strong>Native Business Logic Reuse:</strong> Expose existing native logic to Dart to avoid rewrites and ensure consistency.</li>
                    </ul>
                </div>
            </div>
            <div class="mt-10">
                <h3 class="text-2xl font-semibold mb-3 text-slate-700">Open Discussion</h3>
                <p class="text-slate-600 text-lg">Identifying opportunities and addressing technical questions for our specific context.</p>
            </div>
        </div>
    </section>

    <footer class="text-center p-10 bg-slate-800 text-slate-400 text-sm">
        Flutter Add-to-App Technical Overview &copy; <span id="year"></span>. [Your Company/Team Name Here]
        <p class="mt-2">Built with Tailwind CSS &amp; <i class="fas fa-heart text-red-500"></i> for Flutter Integration</p>
    </footer>

    <script>
        document.getElementById('year').textContent = new Date().getFullYear();
        
        // Smooth scroll for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    const navBarHeight = document.querySelector('.nav-bar')?.offsetHeight || 0;
                    let elementPosition = targetElement.getBoundingClientRect().top;
                    let offsetPosition = elementPosition + window.pageYOffset - navBarHeight;
                    if (targetId === '#what') { 
                         offsetPosition = targetElement.offsetTop - navBarHeight;
                    }
        
                    window.scrollTo({
                        top: offsetPosition,
                        behavior: 'smooth'
                    });
                }
            });
        });

        // Copy code snippet functionality
        document.querySelectorAll('.copy-code-button').forEach(button => {
            button.addEventListener('click', () => {
                const codeSnippetWrapper = button.closest('.code-snippet-wrapper');
                const codeElement = codeSnippetWrapper.querySelector('pre code');
                if (codeElement) {
                    const codeToCopy = codeElement.innerText;
                    navigator.clipboard.writeText(codeToCopy).then(() => {
                        const originalText = button.innerHTML;
                        button.innerHTML = '<i class="fas fa-check"></i> Copied!';
                        button.classList.add('copied');
                        setTimeout(() => {
                            button.innerHTML = originalText;
                            button.classList.remove('copied');
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy text: ', err);
                    });
                }
            });
        });
    </script>

</body>
</html>
